<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muhammad Collections | Order Portal</title>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; padding: 20px; display: flex; justify-content: center; }
        .card { width: 100%; max-width: 480px; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .logo-container { text-align: center; margin-bottom: 20px; }
        .logo-container img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 2px solid #333; }
        h2 { text-align: center; color: #1a1a1a; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .hidden { display: none; }
        label { display: block; margin-top: 15px; font-weight: 600; color: #444; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1em; }
        
        .btn { width: 100%; background: #075E54; color: white; padding: 16px; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin-top: 15px; font-weight: bold; transition: 0.3s; }
        .btn:hover { background: #128C7E; }
        .btn-download { background: #333; margin-top: 10px; }

        /* Slip Styling */
        #orderSlip { border: 2px solid #333; padding: 25px; background: #fff; margin-top: 10px; position: relative; }
        .slip-header { text-align: center; border-bottom: 2px solid #333; margin-bottom: 15px; padding-bottom: 10px; }
        .slip-row { display: flex; justify-content: space-between; margin: 8px 0; font-size: 0.95em; }
        .total-box { background: #f9f9f9; padding: 12px; border-top: 2px solid #333; margin-top: 10px; font-weight: bold; font-size: 1.15em; }
        .verified-stamp { color: #27ae60; font-weight: bold; text-align: center; border: 2px solid #27ae60; width: fit-content; margin: 5px auto; padding: 5px 15px; transform: rotate(-5deg); text-transform: uppercase; font-size: 1.2em; }
        
        .policy-box { font-size: 0.75em; color: #555; background: #fff8e1; padding: 15px; border-radius: 8px; margin-top: 20px; line-height: 1.5; border-left: 4px solid #ffc107; }
        .screenshot-note { text-align: center; font-weight: bold; color: #d32f2f; margin-top: 10px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="card">
    <div class="logo-container">
        <img src="https://i.postimg.cc/tJ94S8rT/logo.jpg" alt="Muhammad Collections Logo">
    </div>

    <div id="formSection">
        <h2>Muhammad Collections</h2>
        <p style="text-align:center; color:#666; font-size: 0.85em; margin-top: 0;">Premium Malai Boski Order Portal</p>

        <label>Full Name</label>
        <input type="text" id="name" placeholder="Enter your name" required>

        <label>Select Color</label>
        <select id="color">
            <option>Black Gul Ahmed</option>
            <option>Navy Blue Boski</option>
            <option>Seafoam Green Boski</option>
            <option>Beige Boski</option>
            <option>Cream/Classic Boski</option>
        </select>

        <div style="display: flex; gap: 10px;">
            <div style="flex: 2;">
                <label>Suit Length</label>
                <select id="length">
                    <option value="4.0" data-price="2400">4.0 Meters (2,400 PKR)</option>
                    <option value="4.5" data-price="2600" selected>4.5 Meters (2,600 PKR)</option>
                    <option value="5.0" data-price="2800">5.0 Meters (2,800 PKR)</option>
                </select>
            </div>
            <div style="flex: 1;">
                <label>Quantity</label>
                <input type="number" id="qty" value="1" min="1">
            </div>
        </div>

        <label>Shipping Address</label>
        <input type="text" id="address" placeholder="City, Area, House No." required>

        <label>Promo Code</label>
        <input type="text" id="promo" placeholder="Enter code (if any)">

        <button type="button" class="btn" onclick="processOrder()">GENERATE ORDER SLIP</button>
    </div>

    <div id="slipSection" class="hidden">
        <div id="captureArea">
            <div id="orderSlip">
                <div class="slip-header">
                    <h3 style="margin:0;">MUHAMMAD COLLECTIONS</h3>
                    <p style="margin:5px 0; font-size: 0.8em;">Official Digital Invoice</p>
                    <small>Order ID: <span id="slipID"></span></small>
                </div>
                
                <div class="verified-stamp">ORDER READY</div>

                <div class="slip-row"><span>Customer:</span> <strong id="slipName"></strong></div>
                <div class="slip-row"><span>Fabric:</span> <span id="slipColor"></span></div>
                <div class="slip-row"><span>Cutting:</span> <span id="slipLength"></span></div>
                <div class="slip-row"><span>Quantity:</span> <span id="slipQty"></span></div>
                <div class="slip-row"><span>Promo:</span> <span id="slipPromo"></span></div>
                <div class="slip-row"><span>Delivery:</span> <span style="color:green;">FREE SHIPPING</span></div>

                <div class="total-box">
                    <div class="slip-row" style="margin:0;"><span>TOTAL BILL:</span> <span id="slipTotal"></span></div>
                </div>
                
                <p style="font-size: 0.6em; text-align: center; margin-top: 15px; color: #888;">Thank you for shopping with Muhammad Collections!</p>
            </div>
        </div>

        <p class="screenshot-note">üì∏ Please Screenshot or Download this slip!</p>
        
        <button class="btn btn-download" onclick="downloadSlip()">DOWNLOAD SLIP IMAGE</button>
        <button class="btn" onclick="sendToWhatsApp()" style="background:#25D366;">SEND VIA WHATSAPP</button>
        
        <div class="policy-box">
            <strong>Terms & Conditions:</strong><br>
            üîÑ <strong>3-Day Exchange:</strong> If the shade isn't perfect, exchange within 3 days. Fabric must be unstitched.<br>
            üöö <strong>Exchange Fee:</strong> 135 PKR delivery charges apply for exchange orders.<br>
            ‚ùå <strong>No Refunds:</strong> Strictly no returns or cash refunds.
        </div>
    </div>
</div>

<script>
    // --- CONFIGURATION ---
    const PUBLIC_KEY = "qLN3VE09GqCkYt_pT";
    const SERVICE_ID = "service_oftxa1f";
    const TEMPLATE_ID = "template_mar3ztq";
    const MY_PHONE = "923172582336"; 

    (function() { emailjs.init(PUBLIC_KEY); })();

    function processOrder() {
        const name = document.getElementById('name').value;
        const address = document.getElementById('address').value;
        const qty = parseInt(document.getElementById('qty').value);

        if(!name || !address || qty < 1) {
            alert("Please complete all fields correctly.");
            return;
        }

        const lenEl = document.getElementById('length');
        const basePrice = parseInt(lenEl.options[lenEl.selectedIndex].getAttribute('data-price'));
        const promo = document.getElementById('promo').value;
        
        const validCodes = ["19081", "19161", "19129", "19009", "19067"];
        const unitPrice = (promo && validCodes.includes(promo)) ? (basePrice - 600) : basePrice;
        const totalBill = unitPrice * qty;

        // Fill Slip
        document.getElementById('slipID').innerText = 'MC-' + Math.floor(1000 + Math.random() * 9000);
        document.getElementById('slipName').innerText = name;
        document.getElementById('slipColor').innerText = document.getElementById('color').value;
        document.getElementById('slipLength').innerText = lenEl.value + " Meters";
        document.getElementById('slipQty').innerText = qty;
        document.getElementById('slipPromo').innerText = (validCodes.includes(promo)) ? promo : "None";
        document.getElementById('slipTotal').innerText = totalBill.toLocaleString() + " PKR";

        // Toggle View
        document.getElementById('formSection').classList.add('hidden');
        document.getElementById('slipSection').classList.remove('hidden');
        window.scrollTo(0, 0);
    }

    function downloadSlip() {
        const element = document.getElementById('captureArea');
        html2canvas(element).then(canvas => {
            const link = document.createElement('a');
            link.download = 'Muhammad-Collections-Slip.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function sendToWhatsApp() {
        const id = document.getElementById('slipID').innerText;
        const name = document.getElementById('slipName').innerText;
        const total = document.getElementById('slipTotal').innerText;
        const address = document.getElementById('address').value;

        // Email Backup
        emailjs.send(SERVICE_ID, TEMPLATE_ID, {
            order_id: id,
            customer_name: name,
            customer_address: address,
            final_bill: total
        });

        // WhatsApp Text
        const message = `*NEW ORDER: ${id}*%0A` +
                        `--------------------------%0A` +
                        `*Customer:* ${name}%0A` +
                        `*Color:* ${document.getElementById('slipColor').innerText}%0A` +
                        `*Qty:* ${document.getElementById('slipQty').innerText}%0A` +
                        `*Address:* ${address}%0A` +
                        `*Total:* ${total}%0A` +
                        `--------------------------%0A` +
                        `Slip has been saved. Please confirm my order!`;

        window.open(`https://wa.me/${MY_PHONE}?text=${message}`, '_blank');
    }
</script>

</body>
</html>
